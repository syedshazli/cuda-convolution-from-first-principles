TODO: Get the indexes working for a generalized algorithm